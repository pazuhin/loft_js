<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
</div>
<hr>
<div id="homework-container">
    <div id="list-block">
        Доступные cookie:
        <table id="list-table">
            <thead>
            <tr>
                <th>имя</th>
                <th>значение</th>
                <th>удалить</th>
            </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        <input id="filter-name-input" name="name" type="text">
        <input id="add-name-input" name="name" type="text">
        <input id="add-value-input" name="value" type="text">
        <button id="add-button">добавить куку</button>
    </div>
</div>

<script>
    const homeworkContainer = document.querySelector('#homework-container');
    const filterNameInput = homeworkContainer.querySelector('#filter-name-input');
    const addNameInput = homeworkContainer.querySelector('#add-name-input');
    const addValueInput = homeworkContainer.querySelector('#add-value-input');
    const addButton = homeworkContainer.querySelector('#add-button');
    const listTable = homeworkContainer.querySelector('#list-table tbody');


    filterNameInput.addEventListener('keyup', function() {
        const value = filterNameInput.value;
        const allCookie = getCookies();
        const res = filterObj(value, allCookie);

        renderTable(res);
    });

    function filterObj(value, obj) {
        let filterObj = {};

        for (let key in obj) {
            if (isMatching(key, value) || isMatching(obj[key], value)) {
                if (obj.hasOwnProperty(key)) {
                    filterObj[key] = obj[key];
                }
            }
        }

        return filterObj;
    }

    window.addEventListener('DOMContentLoaded', ()=>{
        const allCookie = getCookies();

        renderTable(allCookie);
    });

    function deleteRowTable(row) {
        row.parentNode.removeChild(row);
    }

    function getRowTable(name) {
        return document.getElementsByClassName(name)[0];

    }

    addButton.addEventListener('click', () => {
        const name = addNameInput.value;
        const value = addValueInput.value;
        const filterValue = filterNameInput.value;
        const allCookie = getCookies();

        addCookie(name, value);
        console.log(getCookies().hasOwnProperty(name));
        console.log(!isMatching(value, filterValue));
        if (filterValue) {
            if (isMatching(name, filterValue) || isMatching(value, filterValue)) {
                addRowTable(name, value);
            }
            if (allCookie.hasOwnProperty(name) && !isMatching(value, filterValue)) {
                deleteRowTable(getRowTable(name));
            }
        } else {
            renderTable(getCookies());
        }
    });

    function getCookies() {
        const cookie = document.cookie;

        return cookie.split('; ').reduce((prev, current)=>{
            let [name, value] = current.split('=');

            prev[name] = value;

            return prev;
        }, {})

    }
    function addCookie(name, value) {
        document.cookie = `${name}=${value};`;
    }

    function addRowTable(name, value) {
        const tr = document.createElement('tr');
        const tdName = document.createElement('td');
        const tdValue = document.createElement('td');
        const tdDel = document.createElement('td');
        const button = document.createElement('button');

        tdName.innerText = name;
        tdValue.innerText = value;
        button.innerText = 'Удалить';

        button.dataset.name = name;
        button.classList.add('deleteButton');
        tdDel.appendChild(button);

        tr.classList.add(name);
        tr.appendChild(tdName);
        tr.appendChild(tdValue);
        tr.appendChild(tdDel);
        listTable.appendChild(tr);

        button.addEventListener('click', (e) => {
            if (e.target.classList.contains('deleteButton')) {
                deleteCookie(e.target.getAttribute('data-name'));
                listTable.removeChild(tr);
            }
        });
    }

    function renderTable(obj) {
        listTable.innerHTML = '';

        for (let key in obj) {
            if (key !== '') {
                addRowTable(key, obj[key]);
            }
        }
    }

    function deleteCookie(name) {
        document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    }
    function isMatching(full, chunk) {
        let regexp = new RegExp(chunk, 'i');

        if (full.search(regexp) > -1) {
            return true;
        }

        return false;
    }
</script>
</body>
</html>