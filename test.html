<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
</div>
<hr>
<div id="homework-container">
    <div id="list-block">
        Доступные cookie:
        <table id="list-table">
            <thead>
            <tr>
                <th>имя</th>
                <th>значение</th>
                <th>удалить</th>
            </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        <input id="filter-name-input" name="name" type="text">
        <input id="add-name-input" name="name" type="text">
        <input id="add-value-input" name="value" type="text">
        <button id="add-button">добавить куку</button>
    </div>
</div>

<script>
    const homeworkContainer = document.querySelector('#homework-container');
    const filterNameInput = homeworkContainer.querySelector('#filter-name-input');
    const addNameInput = homeworkContainer.querySelector('#add-name-input');
    const addValueInput = homeworkContainer.querySelector('#add-value-input');
    const addButton = homeworkContainer.querySelector('#add-button');
    const listTable = homeworkContainer.querySelector('#list-table tbody');

    function searchForMatches(cookies, value) {
        var matchObj = {};
        let regExp = new RegExp(value);

        if (value == '') {
            return false;
        }

        for (const key in cookies) {
            if (key.match(regExp) || cookies[key].match(regExp)) {
                matchObj[key] = cookies[key];
            }
        }

        return matchObj;
    }

    filterNameInput.addEventListener('keyup', function() {
        let matchArray = searchForMatches(getCookies(), filterNameInput.value);

        if (matchArray) {
            renderTable(matchArray);
        }
    });

    window.addEventListener('DOMContentLoaded', ()=>{
        const allCookie = getCookies();
        renderTable(allCookie);
    });
    function search(val, value) {
        let regExp = new RegExp(value);

        if (val.match(regExp)) {
            return true;
        }

        return false;
    }
    function deleteRowTable(row) {
        row.parentNode.removeChild(row);
    }
    function getRowTable(name) {
        return document.getElementsByClassName(name)[0];

    }

    addButton.addEventListener('click', () => {
        const name = addNameInput.value;
        const value = addValueInput.value;
        const filterValue = filterNameInput.value
        let match = searchForMatches({[name]:value}, filterValue);
        let matchValue = search(value, filterValue);
        console.log(match)
        addCookie(name, value);
        if (filterValue) {
            if (search(name, filterValue) || search(value, filterValue)) {
                addRowTable(name, value);
            }
            if (getCookies().hasOwnProperty(name) && !search(value, filterValue)) {
                console.log(getCookies().hasOwnProperty(name));
                deleteRowTable(getRowTable(name));
            }
        } else {
            renderTable(getCookies());
        }
    });

    function getCookies() {
        const cookie = document.cookie;

        return cookie.split('; ').reduce((prev, current)=>{
            let [name, value] = current.split('=');

            prev[name] = value;

            return prev;
        }, {})

    }
    function addCookie(name, value) {
        document.cookie = `${name}=${value};`;
    }

    function addRowTable(name, value) {
        const tr = document.createElement('tr');
        const tdName = document.createElement('td');
        const tdValue = document.createElement('td');
        const tdDel = document.createElement('td');
        const button = document.createElement('button');

        tdName.innerText = name;
        tdValue.innerText = value;
        button.innerText = 'Удалить';

        button.dataset.name = name;
        button.classList.add('deleteButton');
        tdDel.appendChild(button);

        tr.classList.add(name);
        tr.appendChild(tdName);
        tr.appendChild(tdValue);
        tr.appendChild(tdDel);
        listTable.appendChild(tr);

        button.addEventListener('click', (e) => {
            if (e.target.classList.contains('deleteButton')) {
                deleteCookie(e.target.getAttribute('data-name'));
                listTable.removeChild(tr);
            }
        });
    }

    function renderTable(obj) {
        listTable.innerHTML = '';

        for (let key in obj) {
            if (key !== '') {
                addRowTable(key, obj[key]);
            }
        }
    }

    function deleteCookie(name) {
        document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    }
</script>
</body>
</html>